<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistemas Inteligentes - Aula 4</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1a1a1a;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
        }

        .title {
            font-size: 2.8rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover { transform: translateY(-3px); }

        .card h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 12px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin: 25px 0;
        }

        .highlight-box h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .code-block {
            background: #1e1e1e;
            color: #e8e8e8;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .code-header {
            background: #2d2d2d;
            color: #fff;
            padding: 8px 16px;
            margin: -20px -20px 12px -20px;
            border-radius: 12px 12px 0 0;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
        }

        .step-indicator {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .checkpoint-box {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin: 25px 0;
        }

        .checkpoint-box h3 {
            color: white;
            margin-bottom: 12px;
        }

        .dataset-info {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .dataset-info h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .concept-box {
            background: rgba(118, 75, 162, 0.1);
            border: 2px solid rgba(118, 75, 162, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .concept-box h4 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .syntax-keyword { color: #569cd6; }
        .syntax-string { color: #ce9178; }
        .syntax-comment { color: #6a9955; }
        .syntax-number { color: #b5cea8; }
        .syntax-function { color: #dcdcaa; }

        @media (max-width: 768px) {
            .container { padding: 20px; margin: 10px; }
            .title { font-size: 2.2rem; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="badge">üöÄ Aula 4 - 19/08</div>
            <h1 class="title">Algoritmos de ML na Pr√°tica</h1>
            <p class="subtitle">Da teoria √† implementa√ß√£o: K-Means para segmenta√ß√£o de clientes</p>
        </div>

        <div class="highlight-box">
            <h3>üéØ Objetivo da Aula</h3>
            <p>Hoje vamos <strong>integrar</strong> tudo que aprendemos nas aulas anteriores (fundamentos de IA, estat√≠stica e an√°lise explorat√≥ria) e aplicar nosso <strong>primeiro algoritmo de Machine Learning</strong>: o K-Means. Usaremos um dataset real de e-commerce para segmentar clientes e gerar insights acion√°veis para o neg√≥cio.</p>
        </div>

        <div class="checkpoint-box">
            <h3>üéØ Checkpoint 2 - Pr√≥xima Aula (02/09)</h3>
            <p><strong>Entrega:</strong> Implementa√ß√£o de algoritmos b√°sicos de ML + An√°lise explorat√≥ria completa<br>
            <strong>Hoje fazemos:</strong> Prepara√ß√£o completa para o Checkpoint 2</p>
        </div>

        <!-- Parte 1: Contexto e Dataset -->
        <div class="section">
            <h2><span class="step-indicator">1</span>Contexto: E-commerce Global</h2>
            <p>Vamos trabalhar com um dataset real de um marketplace online com dados de clientes de diferentes pa√≠ses. Nosso objetivo √© aplicar <strong>K-Means clustering</strong> para segmentar clientes e desenvolver estrat√©gias de marketing personalizadas.</p>
            
            <div class="dataset-info">
                <h4>üìä Dataset: Online Retail (UCI)</h4>
                <p><strong>Fonte:</strong> UCI Machine Learning Repository<br>
                <strong>Dados:</strong> 540,000+ transa√ß√µes de loja online (Reino Unido)<br>
                <strong>Per√≠odo:</strong> 01/12/2010 a 09/12/2011<br>
                <strong>Vari√°veis:</strong> InvoiceNo, StockCode, Description, Quantity, InvoiceDate, UnitPrice, CustomerID, Country</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üîß Setup e Importa√ß√£o do Dataset</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># Sistemas Inteligentes - Aula 4: K-Means na Pr√°tica
# Dataset: Online Retail - Segmenta√ß√£o de Clientes</span>

<span class="syntax-keyword">import</span> pandas <span class="syntax-keyword">as</span> pd
<span class="syntax-keyword">import</span> numpy <span class="syntax-keyword">as</span> np
<span class="syntax-keyword">import</span> matplotlib.pyplot <span class="syntax-keyword">as</span> plt
<span class="syntax-keyword">import</span> seaborn <span class="syntax-keyword">as</span> sns
<span class="syntax-keyword">from</span> sklearn.cluster <span class="syntax-keyword">import</span> KMeans
<span class="syntax-keyword">from</span> sklearn.preprocessing <span class="syntax-keyword">import</span> StandardScaler
<span class="syntax-keyword">from</span> sklearn.metrics <span class="syntax-keyword">import</span> silhouette_score
<span class="syntax-keyword">from</span> datetime <span class="syntax-keyword">import</span> datetime, timedelta
<span class="syntax-keyword">import</span> warnings
warnings.filterwarnings(<span class="syntax-string">'ignore'</span>)

<span class="syntax-comment"># Configura√ß√µes de visualiza√ß√£o</span>
plt.style.use(<span class="syntax-string">'seaborn-v0_8-whitegrid'</span>)
sns.set_palette(<span class="syntax-string">"husl"</span>)
plt.rcParams[<span class="syntax-string">'figure.figsize'</span>] = (<span class="syntax-number">12</span>, <span class="syntax-number">6</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">"üõçÔ∏è E-COMMERCE CUSTOMER SEGMENTATION"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 45</span>)

<span class="syntax-comment"># Carregar dataset</span>
<span class="syntax-comment"># URL do dataset no UCI repository</span>
url = <span class="syntax-string">'https://archive.ics.uci.edu/ml/machine-learning-databases/00352/Online%20Retail.xlsx'</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üì• Carregando dataset do UCI Repository..."</span>)

<span class="syntax-keyword">try</span>:
    df = pd.read_excel(url, engine=<span class="syntax-string">'openpyxl'</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Dataset carregado: {df.shape[0]:,} linhas, {df.shape[1]} colunas"</span>)
<span class="syntax-keyword">except</span>:
    <span class="syntax-function">print</span>(<span class="syntax-string">"‚ö†Ô∏è Erro ao carregar. Usando dataset alternativo..."</span>)
    <span class="syntax-comment"># Aqui voc√™ pode colocar um dataset local como backup</span>

<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä Primeiras 5 linhas:"</span>)
<span class="syntax-function">print</span>(df.head())</code></pre>
            </div>
        </div>

        <!-- Parte 2: An√°lise Explorat√≥ria Integrada -->
        <div class="section">
            <h2><span class="step-indicator">2</span>EDA: Revisando Conceitos da Aula 2</h2>
            <p>Vamos aplicar toda a <strong>estat√≠stica descritiva</strong> que aprendemos na aula 2, mas agora com foco na prepara√ß√£o para algoritmos de ML.</p>

            <div class="code-block">
                <div class="code-header">
                    <span>üìä An√°lise Estat√≠stica Direcionada para ML</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># 1. INSPE√á√ÉO INICIAL - Conceitos da Aula 2</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üîç AN√ÅLISE EXPLORAT√ìRIA PARA ML"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 35</span>)

<span class="syntax-comment"># Informa√ß√µes b√°sicas</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìè Shape: {df.shape}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üóÇÔ∏è Colunas: {list(df.columns)}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìã Tipos de dados:"</span>)
<span class="syntax-function">print</span>(df.dtypes)

<span class="syntax-comment"># Valores faltantes - crucial para ML</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\n‚ùì VALORES FALTANTES:"</span>)
missing_data = df.isnull().<span class="syntax-function">sum</span>()
missing_percent = (<span class="syntax-number">100</span> * missing_data / <span class="syntax-function">len</span>(df)).round(<span class="syntax-number">2</span>)
missing_table = pd.DataFrame({
    <span class="syntax-string">'Missing Count'</span>: missing_data,
    <span class="syntax-string">'Percentage'</span>: missing_percent
})
<span class="syntax-function">print</span>(missing_table[missing_table[<span class="syntax-string">'Missing Count'</span>] > <span class="syntax-number">0</span>])

<span class="syntax-comment"># Estat√≠sticas descritivas das vari√°veis num√©ricas</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìä ESTAT√çSTICAS DESCRITIVAS:"</span>)
numeric_cols = df.select_dtypes(include=[np.number]).columns
<span class="syntax-function">print</span>(df[numeric_cols].describe())

<span class="syntax-comment"># An√°lise de outliers - importante para clustering</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ AN√ÅLISE DE OUTLIERS (IQR Method):"</span>)
<span class="syntax-keyword">for</span> col <span class="syntax-keyword">in</span> [<span class="syntax-string">'Quantity'</span>, <span class="syntax-string">'UnitPrice'</span>]:
    Q1 = df[col].quantile(<span class="syntax-number">0.25</span>)
    Q3 = df[col].quantile(<span class="syntax-number">0.75</span>)
    IQR = Q3 - Q1
    lower_bound = Q1 - <span class="syntax-number">1.5</span> * IQR
    upper_bound = Q3 + <span class="syntax-number">1.5</span> * IQR
    outliers = ((df[col] < lower_bound) | (df[col] > upper_bound)).<span class="syntax-function">sum</span>()
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   {col}: {outliers:,} outliers ({outliers/len(df)*100:.2f}%)"</span>)</code></pre>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>üí° Conex√£o com Aula 2</h3>
                    <p><strong>Medidas de tend√™ncia central:</strong> Identificar valores t√≠picos<br>
                    <strong>Dispers√£o:</strong> Entender variabilidade para normaliza√ß√£o<br>
                    <strong>Distribui√ß√µes:</strong> Detectar assimetrias e outliers<br>
                    <strong>Correla√ß√µes:</strong> Features importantes para clustering</p>
                </div>
                <div class="card">
                    <h3>üîß Prepara√ß√£o para ML</h3>
                    <p><strong>Missing values:</strong> Estrat√©gia de imputa√ß√£o<br>
                    <strong>Outliers:</strong> Decidir se remover ou transformar<br>
                    <strong>Scaling:</strong> Normalizar para K-Means<br>
                    <strong>Feature engineering:</strong> Criar vari√°veis RFM</p>
                </div>
            </div>
        </div>

        <!-- Parte 3: Prepara√ß√£o de Dados -->
        <div class="section">
            <h2><span class="step-indicator">3</span>Prepara√ß√£o: Da Estat√≠stica para ML</h2>
            <p>Agora vamos transformar nossos dados em features adequadas para o algoritmo K-Means, aplicando conceitos de <strong>feature engineering</strong>.</p>

            <div class="concept-box">
                <h4>üß† Conceito: An√°lise RFM</h4>
                <p><strong>Recency:</strong> H√° quanto tempo fez a √∫ltima compra<br>
                <strong>Frequency:</strong> Quantas vezes comprou<br>
                <strong>Monetary:</strong> Quanto gastou no total<br><br>
                Essas 3 dimens√µes s√£o ideais para segmentar clientes com K-Means!</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üîß Feature Engineering: Criando Vari√°veis RFM</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># PREPARA√á√ÉO DOS DADOS PARA K-MEANS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üîß FEATURE ENGINEERING"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 25</span>)

<span class="syntax-comment"># 1. Limpeza b√°sica</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üßπ Limpando dados..."</span>)
df_clean = df.dropna(subset=[<span class="syntax-string">'CustomerID'</span>])  <span class="syntax-comment"># Remove linhas sem CustomerID</span>
df_clean = df_clean[df_clean[<span class="syntax-string">'Quantity'</span>] > <span class="syntax-number">0</span>]      <span class="syntax-comment"># Remove devolu√ß√µes</span>
df_clean = df_clean[df_clean[<span class="syntax-string">'UnitPrice'</span>] > <span class="syntax-number">0</span>]    <span class="syntax-comment"># Remove pre√ßos inv√°lidos</span>

<span class="syntax-comment"># Criar vari√°vel Revenue</span>
df_clean[<span class="syntax-string">'Revenue'</span>] = df_clean[<span class="syntax-string">'Quantity'</span>] * df_clean[<span class="syntax-string">'UnitPrice'</span>]

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Dados limpos: {df_clean.shape[0]:,} transa√ß√µes"</span>)

<span class="syntax-comment"># 2. CONSTRUIR FEATURES RFM</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìä Construindo features RFM..."</span>)

<span class="syntax-comment"># Data de refer√™ncia (√∫ltima data do dataset + 1 dia)</span>
reference_date = df_clean[<span class="syntax-string">'InvoiceDate'</span>].<span class="syntax-function">max</span>() + timedelta(days=<span class="syntax-number">1</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìÖ Data de refer√™ncia: {reference_date.strftime('%d/%m/%Y')}"</span>)

<span class="syntax-comment"># Agregar por cliente</span>
rfm = df_clean.groupby(<span class="syntax-string">'CustomerID'</span>).agg({
    <span class="syntax-string">'InvoiceDate'</span>: <span class="syntax-keyword">lambda</span> x: (reference_date - x.<span class="syntax-function">max</span>()).days,  <span class="syntax-comment"># Recency</span>
    <span class="syntax-string">'InvoiceNo'</span>: <span class="syntax-string">'count'</span>,                                      <span class="syntax-comment"># Frequency</span>
    <span class="syntax-string">'Revenue'</span>: <span class="syntax-string">'sum'</span>                                            <span class="syntax-comment"># Monetary</span>
}).round(<span class="syntax-number">2</span>)

<span class="syntax-comment"># Renomear colunas</span>
rfm.columns = [<span class="syntax-string">'Recency'</span>, <span class="syntax-string">'Frequency'</span>, <span class="syntax-string">'Monetary'</span>]

<span class="syntax-comment"># Filtrar clientes com valores v√°lidos</span>
rfm = rfm[rfm[<span class="syntax-string">'Monetary'</span>] > <span class="syntax-number">0</span>]

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ RFM calculado para {len(rfm):,} clientes"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìã Estat√≠sticas RFM:"</span>)
<span class="syntax-function">print</span>(rfm.describe())

<span class="syntax-comment"># 3. AN√ÅLISE EXPLORAT√ìRIA DAS FEATURES RFM</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüîç AN√ÅLISE DAS FEATURES RFM:"</span>)

<span class="syntax-comment"># Correla√ß√µes entre features</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä Matriz de correla√ß√£o:"</span>)
<span class="syntax-function">print</span>(rfm.corr().round(<span class="syntax-number">3</span>))

<span class="syntax-comment"># Detectar outliers extremos</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ Outliers extremos (Z-score > 3):"</span>)
<span class="syntax-keyword">from</span> scipy <span class="syntax-keyword">import</span> stats
<span class="syntax-keyword">for</span> col <span class="syntax-keyword">in</span> rfm.columns:
    z_scores = np.<span class="syntax-function">abs</span>(stats.zscore(rfm[col]))
    outliers = (z_scores > <span class="syntax-number">3</span>).<span class="syntax-function">sum</span>()
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   {col}: {outliers} outliers extremos"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 4: K-Means Theory e Implementation -->
        <div class="section">
            <h2><span class="step-indicator">4</span>Algoritmo K-Means: Da Teoria √† Pr√°tica</h2>
            
            <div class="concept-box">
                <h4>üß† Como funciona o K-Means?</h4>
                <p><strong>1. Escolha k</strong> (n√∫mero de clusters)<br>
                <strong>2. Inicializa</strong> k centroides aleatoriamente<br>
                <strong>3. Atribui</strong> cada ponto ao centroide mais pr√≥ximo<br>
                <strong>4. Recalcula</strong> centroides (m√©dia dos pontos)<br>
                <strong>5. Repete</strong> passos 3-4 at√© converg√™ncia</p>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>‚úÖ Vantagens do K-Means</h3>
                    <p>‚Ä¢ Simples e r√°pido<br>
                    ‚Ä¢ Funciona bem com clusters esf√©ricos<br>
                    ‚Ä¢ Escal√°vel para grandes datasets<br>
                    ‚Ä¢ Boa interpretabilidade</p>
                </div>
                <div class="card">
                    <h3>‚ö†Ô∏è Limita√ß√µes</h3>
                    <p>‚Ä¢ Precisa definir k previamente<br>
                    ‚Ä¢ Sens√≠vel a outliers<br>
                    ‚Ä¢ Assume clusters esf√©ricos<br>
                    ‚Ä¢ Sens√≠vel √† escala das vari√°veis</p>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üéØ Implementa√ß√£o K-Means: Passo a Passo</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># K-MEANS PARA SEGMENTA√á√ÉO DE CLIENTES</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üéØ IMPLEMENTA√á√ÉO K-MEANS"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 30</span>)

<span class="syntax-comment"># 1. NORMALIZA√á√ÉO DOS DADOS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üìè Normalizando dados (Z-score)..."</span>)

<span class="syntax-comment"># Por que normalizar? K-Means usa dist√¢ncia euclidiana!</span>
scaler = StandardScaler()
rfm_scaled = scaler.fit_transform(rfm)
rfm_scaled_df = pd.DataFrame(rfm_scaled, columns=rfm.columns, index=rfm.index)

<span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Dados normalizados:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   M√©dia: {rfm_scaled_df.mean().round(3).values}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   Desvio: {rfm_scaled_df.std().round(3).values}"</span>)

<span class="syntax-comment"># 2. M√âTODO DO COTOVELO PARA ESCOLHER K</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìä M√©todo do Cotovelo para escolher K..."</span>)

inertias = []
silhouette_scores = []
k_range = <span class="syntax-function">range</span>(<span class="syntax-number">2</span>, <span class="syntax-number">11</span>)

<span class="syntax-keyword">for</span> k <span class="syntax-keyword">in</span> k_range:
    kmeans = KMeans(n_clusters=k, random_state=<span class="syntax-number">42</span>, n_init=<span class="syntax-number">10</span>)
    kmeans.fit(rfm_scaled)
    inertias.append(kmeans.inertia_)
    silhouette_avg = silhouette_score(rfm_scaled, kmeans.labels_)
    silhouette_scores.append(silhouette_avg)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   K={k}: Inertia={kmeans.inertia_:.2f}, Silhouette={silhouette_avg:.3f}"</span>)

<span class="syntax-comment"># Escolher K com melhor silhouette score</span>
optimal_k = k_range[np.argmax(silhouette_scores)]
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ K √≥timo escolhido: {optimal_k} (melhor silhouette score)"</span>)

<span class="syntax-comment"># 3. APLICAR K-MEANS COM K √ìTIMO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüöÄ Aplicando K-Means com K={optimal_k}..."</span>)

final_kmeans = KMeans(n_clusters=optimal_k, random_state=<span class="syntax-number">42</span>, n_init=<span class="syntax-number">10</span>)
cluster_labels = final_kmeans.fit_predict(rfm_scaled)

<span class="syntax-comment"># Adicionar labels aos dados originais</span>
rfm[<span class="syntax-string">'Cluster'</span>] = cluster_labels

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Clustering conclu√≠do!"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä Distribui√ß√£o dos clusters:"</span>)
<span class="syntax-function">print</span>(rfm[<span class="syntax-string">'Cluster'</span>].value_counts().sort_index())</code></pre>
            </div>
        </div>

        <!-- Parte 5: An√°lise dos Resultados -->
        <div class="section">
            <h2><span class="step-indicator">5</span>Interpreta√ß√£o: De Clusters para Insights de Neg√≥cio</h2>
            <p>O verdadeiro valor do ML est√° na <strong>interpreta√ß√£o</strong> dos resultados e na <strong>gera√ß√£o de insights</strong> acion√°veis para o neg√≥cio.</p>

            <div class="code-block">
                <div class="code-header">
                    <span>üìä An√°lise de Clusters e Insights de Neg√≥cio</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># AN√ÅLISE DOS CLUSTERS GERADOS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üìä AN√ÅLISE DOS CLUSTERS"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 25</span>)

<span class="syntax-comment"># 1. PERFIL DE CADA CLUSTER</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üë• PERFIL DOS CLUSTERS:"</span>)
cluster_summary = rfm.groupby(<span class="syntax-string">'Cluster'</span>).agg({
    <span class="syntax-string">'Recency'</span>: [<span class="syntax-string">'mean'</span>, <span class="syntax-string">'median'</span>],
    <span class="syntax-string">'Frequency'</span>: [<span class="syntax-string">'mean'</span>, <span class="syntax-string">'median'</span>],
    <span class="syntax-string">'Monetary'</span>: [<span class="syntax-string">'mean'</span>, <span class="syntax-string">'median'</span>]
}).round(<span class="syntax-number">2</span>)

cluster_summary.columns = [<span class="syntax-string">'_'</span>.join(col).strip() <span class="syntax-keyword">for</span> col <span class="syntax-keyword">in</span> cluster_summary.columns]
<span class="syntax-function">print</span>(cluster_summary)

<span class="syntax-comment"># 2. INTERPRETA√á√ÉO DOS CLUSTERS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ INTERPRETA√á√ÉO DOS CLUSTERS:"</span>)

<span class="syntax-keyword">for</span> cluster <span class="syntax-keyword">in</span> <span class="syntax-function">range</span>(optimal_k):
    cluster_data = rfm[rfm[<span class="syntax-string">'Cluster'</span>] == cluster]
    size = <span class="syntax-function">len</span>(cluster_data)
    avg_recency = cluster_data[<span class="syntax-string">'Recency'</span>].mean()
    avg_frequency = cluster_data[<span class="syntax-string">'Frequency'</span>].mean()
    avg_monetary = cluster_data[<span class="syntax-string">'Monetary'</span>].mean()
    
    <span class="syntax-function">print</span>(<span class="syntax-string">f"\nüè∑Ô∏è CLUSTER {cluster} ({size:,} clientes - {size/len(rfm)*100:.1f}%)"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üìÖ Recency: {avg_recency:.0f} dias (√∫ltima compra)"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üî¢ Frequency: {avg_frequency:.1f} compras"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∞ Monetary: ¬£{avg_monetary:.2f} gasto total"</span>)
    
    <span class="syntax-comment"># Classificar tipo de cliente</span>
    <span class="syntax-keyword">if</span> avg_recency < <span class="syntax-number">50</span> <span class="syntax-keyword">and</span> avg_monetary > <span class="syntax-number">1000</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚≠ê TIPO: Clientes VIP (Recentes e Alto Valor)"</span>)
    <span class="syntax-keyword">elif</span> avg_recency > <span class="syntax-number">200</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üò¥ TIPO: Clientes Dormentes (N√£o compram h√° muito tempo)"</span>)
    <span class="syntax-keyword">elif</span> avg_frequency > <span class="syntax-number">100</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üî• TIPO: Clientes Frequentes (Muitas compras)"</span>)
    <span class="syntax-keyword">elif</span> avg_monetary < <span class="syntax-number">100</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∏ TIPO: Clientes Baixo Valor"</span>)
    <span class="syntax-keyword">else</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üë§ TIPO: Clientes Regulares"</span>)

<span class="syntax-comment"># 3. INSIGHTS DE NEG√ìCIO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüí° INSIGHTS DE NEG√ìCIO:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 25</span>)

total_customers = <span class="syntax-function">len</span>(rfm)
total_revenue = rfm[<span class="syntax-string">'Monetary'</span>].<span class="syntax-function">sum</span>()

<span class="syntax-keyword">for</span> cluster <span class="syntax-keyword">in</span> <span class="syntax-function">range</span>(optimal_k):
    cluster_data = rfm[rfm[<span class="syntax-string">'Cluster'</span>] == cluster]
    cluster_revenue = cluster_data[<span class="syntax-string">'Monetary'</span>].<span class="syntax-function">sum</span>()
    revenue_share = cluster_revenue / total_revenue * <span class="syntax-number">100</span>
    
    <span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìà Cluster {cluster}:"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∞ Representa {revenue_share:.1f}% da receita total"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üë• {len(cluster_data)/total_customers*100:.1f}% dos clientes"</span>)
    
    <span class="syntax-keyword">if</span> revenue_share > <span class="syntax-number">30</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üéØ A√á√ÉO: Foco em reten√ß√£o - grupo de alto valor!"</span>)
    <span class="syntax-keyword">elif</span> cluster_data[<span class="syntax-string">'Recency'</span>].mean() > <span class="syntax-number">150</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üìß A√á√ÉO: Campanha de reativa√ß√£o necess√°ria"</span>)
    <span class="syntax-keyword">else</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üìä A√á√ÉO: Monitorar e nutrir relacionamento"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 6: Visualiza√ß√£o -->
        <div class="section">
            <h2><span class="step-indicator">6</span>Visualiza√ß√£o dos Resultados</h2>
            
            <div class="code-block">
                <div class="code-header">
                    <span>üìä Criando Visualiza√ß√µes Impactantes</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># VISUALIZA√á√ïES DOS CLUSTERS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üìä CRIANDO VISUALIZA√á√ïES"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 28</span>)

<span class="syntax-comment"># 1. Scatter plot 3D dos clusters</span>
<span class="syntax-keyword">from</span> mpl_toolkits.mplot3d <span class="syntax-keyword">import</span> Axes3D

fig = plt.figure(figsize=(<span class="syntax-number">15</span>, <span class="syntax-number">12</span>))

<span class="syntax-comment"># Plot 3D</span>
ax1 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">2</span>, <span class="syntax-number">1</span>, projection=<span class="syntax-string">'3d'</span>)
colors = [<span class="syntax-string">'red'</span>, <span class="syntax-string">'blue'</span>, <span class="syntax-string">'green'</span>, <span class="syntax-string">'orange'</span>, <span class="syntax-string">'purple'</span>]
<span class="syntax-keyword">for</span> i <span class="syntax-keyword">in</span> <span class="syntax-function">range</span>(optimal_k):
    cluster_data = rfm[rfm[<span class="syntax-string">'Cluster'</span>] == i]
    ax1.scatter(cluster_data[<span class="syntax-string">'Recency'</span>], 
               cluster_data[<span class="syntax-string">'Frequency'</span>], 
               cluster_data[<span class="syntax-string">'Monetary'</span>],
               c=colors[i], label=<span class="syntax-string">f'Cluster {i}'</span>, alpha=<span class="syntax-number">0.6</span>)

ax1.set_xlabel(<span class="syntax-string">'Recency (dias)'</span>)
ax1.set_ylabel(<span class="syntax-string">'Frequency'</span>)
ax1.set_zlabel(<span class="syntax-string">'Monetary (¬£)'</span>)
ax1.set_title(<span class="syntax-string">'Clusters RFM - Vis√£o 3D'</span>)
ax1.legend()

<span class="syntax-comment"># 2. Box plots por cluster</span>
ax2 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">2</span>, <span class="syntax-number">2</span>)
rfm.boxplot(column=<span class="syntax-string">'Monetary'</span>, by=<span class="syntax-string">'Cluster'</span>, ax=ax2)
ax2.set_title(<span class="syntax-string">'Distribui√ß√£o do Valor Monet√°rio por Cluster'</span>)
ax2.set_xlabel(<span class="syntax-string">'Cluster'</span>)
ax2.set_ylabel(<span class="syntax-string">'Monetary (¬£)'</span>)

<span class="syntax-comment"># 3. Heatmap dos centroides</span>
ax3 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">2</span>, <span class="syntax-number">3</span>)
centroids_df = pd.DataFrame(final_kmeans.cluster_centers_, 
                           columns=[<span class="syntax-string">'Recency'</span>, <span class="syntax-string">'Frequency'</span>, <span class="syntax-string">'Monetary'</span>])
sns.heatmap(centroids_df.T, annot=<span class="syntax-keyword">True</span>, fmt=<span class="syntax-string">'.2f'</span>, cmap=<span class="syntax-string">'viridis'</span>, ax=ax3)
ax3.set_title(<span class="syntax-string">'Centroides dos Clusters (Normalizados)'</span>)
ax3.set_xlabel(<span class="syntax-string">'Cluster'</span>)

<span class="syntax-comment"># 4. Distribui√ß√£o dos clusters</span>
ax4 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">2</span>, <span class="syntax-number">4</span>)
cluster_counts = rfm[<span class="syntax-string">'Cluster'</span>].value_counts().sort_index()
ax4.pie(cluster_counts.values, labels=[<span class="syntax-string">f'Cluster {i}'</span> <span class="syntax-keyword">for</span> i <span class="syntax-keyword">in</span> cluster_counts.index], 
        autopct=<span class="syntax-string">'%1.1f%%'</span>, colors=colors[:optimal_k])
ax4.set_title(<span class="syntax-string">'Distribui√ß√£o dos Clientes por Cluster'</span>)

plt.tight_layout()
plt.show()

<span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Visualiza√ß√µes criadas!"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 7: Pr√≥ximos Passos -->
        <div class="section">
            <h2><span class="step-indicator">7</span>Pr√≥ximos Passos e Checkpoint 2</h2>
            
            <div class="checkpoint-box">
                <h3>üéØ Checkpoint 2 (02/09) - Checklist</h3>
                <p><strong>‚úÖ Dataset escolhido e carregado</strong><br>
                <strong>‚úÖ EDA completa (estat√≠sticas, distribui√ß√µes, correla√ß√µes)</strong><br>
                <strong>‚úÖ Prepara√ß√£o dos dados (limpeza, normaliza√ß√£o)</strong><br>
                <strong>‚úÖ Implementa√ß√£o K-Means</strong><br>
                <strong>‚úÖ An√°lise e interpreta√ß√£o dos resultados</strong><br>
                <strong>‚úÖ Visualiza√ß√µes impactantes</strong><br>
                <strong>‚úÖ Insights de neg√≥cio documentados</strong></p>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>üîÑ Para seu Projeto</h3>
                    <p><strong>1. Adapte este c√≥digo</strong> para seu dataset<br>
                    <strong>2. Experimente</strong> outros valores de K<br>
                    <strong>3. Teste</strong> diferentes features<br>
                    <strong>4. Documente</strong> todos os insights<br>
                    <strong>5. Prepare</strong> apresenta√ß√£o de 10 min</p>
                </div>
                <div class="card">
                    <h3>üöÄ Pr√≥xima Aula (26/08)</h3>
                    <p><strong>T√≥pico:</strong> Regress√£o Log√≠stica<br>
                    <strong>Dataset:</strong> Classifica√ß√£o bin√°ria<br>
                    <strong>Objetivo:</strong> Prever comportamento do cliente<br>
                    <strong>Integra√ß√£o:</strong> Usar clusters como features</p>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üíæ Salvando Resultados para Pr√≥xima Aula</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># SALVANDO RESULTADOS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üíæ Salvando resultados para pr√≥ximas aulas..."</span>)

<span class="syntax-comment"># Salvar dataset com clusters</span>
rfm.to_csv(<span class="syntax-string">'customer_segments.csv'</span>)

<span class="syntax-comment"># Salvar modelo para reutiliza√ß√£o</span>
<span class="syntax-keyword">import</span> pickle
<span class="syntax-keyword">with</span> <span class="syntax-function">open</span>(<span class="syntax-string">'kmeans_model.pkl'</span>, <span class="syntax-string">'wb'</span>) <span class="syntax-keyword">as</span> f:
    pickle.dump(final_kmeans, f)

<span class="syntax-keyword">with</span> <span class="syntax-function">open</span>(<span class="syntax-string">'scaler.pkl'</span>, <span class="syntax-string">'wb'</span>) <span class="syntax-keyword">as</span> f:
    pickle.dump(scaler, f)

<span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Arquivos salvos:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   üìä customer_segments.csv - Dataset com clusters"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   ü§ñ kmeans_model.pkl - Modelo treinado"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   üìè scaler.pkl - Normalizador"</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéâ AULA 4 CONCLU√çDA!"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"Voc√™s aplicaram com sucesso:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Estat√≠stica descritiva (Aula 2)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ An√°lise explorat√≥ria (Aula 3)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Primeiro algoritmo de ML (Aula 4)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üöÄ Pr√≥ximo: Regress√£o Log√≠stica!"</span>)</code></pre>
            </div>
        </div>

        <div class="highlight-box">
            <h3>üåü Parab√©ns!</h3>
            <p>Voc√™s acabaram de completar sua primeira implementa√ß√£o completa de Machine Learning! Integraram conceitos de estat√≠stica, an√°lise explorat√≥ria e clustering para gerar insights valiosos de neg√≥cio. Isso √© exatamente o que fazem cientistas de dados no mundo real!</p>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.closest('.code-block');
            const code = codeBlock.querySelector('code').textContent;
            
            navigator.clipboard.writeText(code).then(function() {
                button.textContent = 'Copiado!';
                button.style.background = '#28a745';
                
                setTimeout(function() {
                    button.textContent = 'Copiar';
                    button.style.background = '#667eea';
                }, 2000);
            });
        }
    </script>
</body>
</html>