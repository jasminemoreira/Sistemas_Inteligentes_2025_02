<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistemas Inteligentes - Aula 5</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #1a1a1a;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(102, 126, 234, 0.3);
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .badge {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 12px 24px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 20px;
        }

        .title {
            font-size: 2.8rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 16px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
        }

        .section {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 16px;
            padding: 30px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            font-size: 1.8rem;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .card {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid rgba(102, 126, 234, 0.2);
            transition: transform 0.3s ease;
        }

        .card:hover { transform: translateY(-3px); }

        .card h3 {
            color: #667eea;
            font-size: 1.3rem;
            margin-bottom: 12px;
        }

        .highlight-box {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 30px;
            border-radius: 16px;
            margin: 25px 0;
        }

        .highlight-box h3 {
            color: white;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .code-block {
            background: #1e1e1e;
            color: #e8e8e8;
            padding: 20px;
            border-radius: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            margin: 15px 0;
            border-left: 4px solid #667eea;
        }

        .code-header {
            background: #2d2d2d;
            color: #fff;
            padding: 8px 16px;
            margin: -20px -20px 12px -20px;
            border-radius: 12px 12px 0 0;
            font-size: 12px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 10px;
            cursor: pointer;
        }

        .step-indicator {
            background: #667eea;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
        }

        .checkpoint-box {
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            padding: 25px;
            border-radius: 16px;
            margin: 25px 0;
        }

        .checkpoint-box h3 {
            color: white;
            margin-bottom: 12px;
        }

        .dataset-info {
            background: rgba(102, 126, 234, 0.1);
            border: 2px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .dataset-info h4 {
            color: #667eea;
            margin-bottom: 10px;
        }

        .concept-box {
            background: rgba(118, 75, 162, 0.1);
            border: 2px solid rgba(118, 75, 162, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .concept-box h4 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .syntax-keyword { color: #569cd6; }
        .syntax-string { color: #ce9178; }
        .syntax-comment { color: #6a9955; }
        .syntax-number { color: #b5cea8; }
        .syntax-function { color: #dcdcaa; }

        .metrics-box {
            background: rgba(40, 167, 69, 0.1);
            border: 2px solid rgba(40, 167, 69, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .metrics-box h4 {
            color: #28a745;
            margin-bottom: 10px;
        }

        .formula-box {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Times New Roman', serif;
        }

        .formula-box h4 {
            color: #ffc107;
            margin-bottom: 10px;
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', system-ui, sans-serif;
        }

        @media (max-width: 768px) {
            .container { padding: 20px; margin: 10px; }
            .title { font-size: 2.2rem; }
            .grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="badge">üéØ Aula 5 - 26/08</div>
            <h1 class="title">Regress√£o Log√≠stica na Pr√°tica</h1>
            <p class="subtitle">Do clustering √† classifica√ß√£o: Prevendo comportamento do cliente</p>
        </div>

        <div class="highlight-box">
            <h3>üîó Conectando com a Aula Anterior</h3>
            <p>Na aula 4, segmentamos clientes com <strong>K-Means</strong>. Hoje vamos usar esses clusters como features para um modelo de <strong>classifica√ß√£o</strong>: a Regress√£o Log√≠stica. Vamos prever se um cliente far√° uma nova compra nos pr√≥ximos 30 dias!</p>
        </div>

        <div class="checkpoint-box">
            <h3>üéØ Checkpoint 2 - Pr√≥xima Aula (02/09)</h3>
            <p><strong>Hoje completamos:</strong> Implementa√ß√£o de algoritmos b√°sicos de ML + An√°lise explorat√≥ria completa<br>
            <strong>Entrega:</strong> Projeto com K-Means + Regress√£o Log√≠stica + Insights de neg√≥cio<br>
            <strong>Status:</strong> Finalizando prepara√ß√£o completa</p>
        </div>

        <!-- Parte 1: Teoria da Regress√£o Log√≠stica -->
        <div class="section">
            <h2><span class="step-indicator">1</span>Regress√£o Log√≠stica: Fundamentos</h2>
            <p>Diferente da <strong>regress√£o linear</strong> (que prev√™ valores cont√≠nuos), a <strong>regress√£o log√≠stica</strong> √© usada para <strong>classifica√ß√£o</strong> - prever categorias ou probabilidades de eventos.</p>
            
            <div class="concept-box">
                <h4>üß† Por que Regress√£o "Log√≠stica"?</h4>
                <p>Usa a <strong>fun√ß√£o log√≠stica (sigmoid)</strong> para mapear qualquer valor real para um intervalo entre 0 e 1, perfect para probabilidades!<br><br>
                <strong>Sigmoid:</strong> Converte valores em probabilidades<br>
                <strong>Threshold:</strong> Geralmente 0.5 para classifica√ß√£o bin√°ria<br>
                <strong>Output:</strong> Probabilidade de pertencer √† classe positiva</p>
            </div>

            <div class="formula-box">
                <h4>üìê F√≥rmula da Fun√ß√£o Sigmoid</h4>
                <p><strong>œÉ(z) = 1 / (1 + e^(-z))</strong><br><br>
                Onde: <strong>z = Œ≤‚ÇÄ + Œ≤‚ÇÅx‚ÇÅ + Œ≤‚ÇÇx‚ÇÇ + ... + Œ≤‚Çôx‚Çô</strong><br><br>
                <strong>z > 0</strong> ‚Üí œÉ(z) > 0.5 ‚Üí Classe 1<br>
                <strong>z < 0</strong> ‚Üí œÉ(z) < 0.5 ‚Üí Classe 0</p>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>‚úÖ Vantagens</h3>
                    <p>‚Ä¢ Fornece probabilidades interpret√°veis<br>
                    ‚Ä¢ N√£o assume distribui√ß√£o normal<br>
                    ‚Ä¢ Menos sens√≠vel a outliers<br>
                    ‚Ä¢ Computacionalmente eficiente<br>
                    ‚Ä¢ Boa baseline para classifica√ß√£o</p>
                </div>
                <div class="card">
                    <h3>‚ö†Ô∏è Limita√ß√µes</h3>
                    <p>‚Ä¢ Assume rela√ß√£o linear entre features e log-odds<br>
                    ‚Ä¢ Sens√≠vel a features correlacionadas<br>
                    ‚Ä¢ Precisa de mais dados para estabilidade<br>
                    ‚Ä¢ Dificuldade com rela√ß√µes complexas n√£o-lineares</p>
                </div>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üìö Setup: Preparando Ambiente e Dados</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># Sistemas Inteligentes - Aula 5: Regress√£o Log√≠stica
# Classifica√ß√£o: Prever comportamento de compra do cliente</span>

<span class="syntax-keyword">import</span> pandas <span class="syntax-keyword">as</span> pd
<span class="syntax-keyword">import</span> numpy <span class="syntax-keyword">as</span> np
<span class="syntax-keyword">import</span> matplotlib.pyplot <span class="syntax-keyword">as</span> plt
<span class="syntax-keyword">import</span> seaborn <span class="syntax-keyword">as</span> sns
<span class="syntax-keyword">from</span> sklearn.model_selection <span class="syntax-keyword">import</span> train_test_split, cross_val_score
<span class="syntax-keyword">from</span> sklearn.linear_model <span class="syntax-keyword">import</span> LogisticRegression
<span class="syntax-keyword">from</span> sklearn.preprocessing <span class="syntax-keyword">import</span> StandardScaler
<span class="syntax-keyword">from</span> sklearn.metrics <span class="syntax-keyword">import</span> (accuracy_score, precision_score, 
                                recall_score, f1_score, roc_auc_score,
                                confusion_matrix, classification_report, roc_curve)
<span class="syntax-keyword">from</span> datetime <span class="syntax-keyword">import</span> datetime, timedelta
<span class="syntax-keyword">import</span> pickle
<span class="syntax-keyword">import</span> warnings
warnings.filterwarnings(<span class="syntax-string">'ignore'</span>)

<span class="syntax-comment"># Configura√ß√µes de visualiza√ß√£o</span>
plt.style.use(<span class="syntax-string">'seaborn-v0_8-whitegrid'</span>)
sns.set_palette(<span class="syntax-string">"husl"</span>)
plt.rcParams[<span class="syntax-string">'figure.figsize'</span>] = (<span class="syntax-number">12</span>, <span class="syntax-number">6</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">"üéØ REGRESS√ÉO LOG√çSTICA PARA E-COMMERCE"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 45</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"üìä Objetivo: Prever se cliente comprar√° nos pr√≥ximos 30 dias"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"üîó Usando: Clusters da Aula 4 + Features RFM"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 2: Prepara√ß√£o dos Dados -->
        <div class="section">
            <h2><span class="step-indicator">2</span>Prepara√ß√£o: De Clusters para Classifica√ß√£o</h2>
            <p>Vamos carregar os dados da aula 4 e criar nossa <strong>vari√°vel target</strong> - se o cliente comprar√° novamente.</p>

            <div class="concept-box">
                <h4>üéØ Problema de Neg√≥cio</h4>
                <p><strong>Pergunta:</strong> "Quais clientes t√™m maior probabilidade de fazer uma nova compra nos pr√≥ximos 30 dias?"<br><br>
                <strong>Features:</strong> RFM + Cluster + Estat√≠sticas de compra<br>
                <strong>Target:</strong> will_purchase_next_month (0 = N√£o, 1 = Sim)<br>
                <strong>Aplica√ß√£o:</strong> Campanhas de marketing direcionadas</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üîß Carregando Dados e Criando Target</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># CARREGANDO DADOS DA AULA 4</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üîÑ Carregando dados da aula anterior..."</span>)

<span class="syntax-comment"># Tentar carregar dados salvos da aula 4</span>
<span class="syntax-keyword">try</span>:
    <span class="syntax-comment"># Se voc√™ salvou os dados da aula 4</span>
    customer_segments = pd.read_csv(<span class="syntax-string">'customer_segments.csv'</span>, index_col=<span class="syntax-number">0</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Dados carregados do arquivo local"</span>)
<span class="syntax-keyword">except</span>:
    <span class="syntax-function">print</span>(<span class="syntax-string">"‚ö†Ô∏è Arquivo local n√£o encontrado. Recriando dados..."</span>)
    
    <span class="syntax-comment"># Recriar dados b√°sicos para demonstra√ß√£o</span>
    <span class="syntax-comment"># Simulando dados do e-commerce</span>
    np.random.seed(<span class="syntax-number">42</span>)
    n_customers = <span class="syntax-number">2000</span>
    
    customer_segments = pd.DataFrame({
        <span class="syntax-string">'Recency'</span>: np.random.gamma(<span class="syntax-number">2</span>, <span class="syntax-number">50</span>, n_customers),
        <span class="syntax-string">'Frequency'</span>: np.random.poisson(<span class="syntax-number">25</span>, n_customers) + <span class="syntax-number">1</span>,
        <span class="syntax-string">'Monetary'</span>: np.random.lognormal(<span class="syntax-number">5</span>, <span class="syntax-number">1</span>, n_customers),
        <span class="syntax-string">'Cluster'</span>: np.random.choice([<span class="syntax-number">0</span>, <span class="syntax-number">1</span>, <span class="syntax-number">2</span>, <span class="syntax-number">3</span>], n_customers)
    })
    
    customer_segments.index.name = <span class="syntax-string">'CustomerID'</span>
    <span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Dados simulados criados"</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä Dataset carregado: {customer_segments.shape[0]:,} clientes"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìã Colunas: {list(customer_segments.columns)}"</span>)

<span class="syntax-comment"># Mostrar distribui√ß√£o dos clusters</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüè∑Ô∏è Distribui√ß√£o dos clusters:"</span>)
<span class="syntax-function">print</span>(customer_segments[<span class="syntax-string">'Cluster'</span>].value_counts().sort_index())

<span class="syntax-comment"># CRIAR VARI√ÅVEL TARGET</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ Criando vari√°vel target..."</span>)

<span class="syntax-comment"># L√≥gica para determinar se o cliente vai comprar novamente
# Baseada na an√°lise RFM: Recency baixa e Monetary/Frequency altas = maior chance</span>

<span class="syntax-comment"># Calcular probabilidade base usando RFM</span>
prob_base = (
    (<span class="syntax-number">1</span> / (<span class="syntax-number">1</span> + customer_segments[<span class="syntax-string">'Recency'</span>] / <span class="syntax-number">100</span>)) * <span class="syntax-number">0.4</span> +  <span class="syntax-comment"># Recency weight</span>
    (customer_segments[<span class="syntax-string">'Frequency'</span>] / customer_segments[<span class="syntax-string">'Frequency'</span>].max()) * <span class="syntax-number">0.3</span> +  <span class="syntax-comment"># Frequency weight</span>
    (customer_segments[<span class="syntax-string">'Monetary'</span>] / customer_segments[<span class="syntax-string">'Monetary'</span>].max()) * <span class="syntax-number">0.3</span>    <span class="syntax-comment"># Monetary weight</span>
)

<span class="syntax-comment"># Adicionar efeito do cluster</span>
cluster_effect = customer_segments[<span class="syntax-string">'Cluster'</span>].map({
    <span class="syntax-number">0</span>: <span class="syntax-number">0.2</span>,  <span class="syntax-comment"># Cluster de baixo valor</span>
    <span class="syntax-number">1</span>: <span class="syntax-number">0.8</span>,  <span class="syntax-comment"># Cluster VIP</span>
    <span class="syntax-number">2</span>: <span class="syntax-number">0.6</span>,  <span class="syntax-comment"># Cluster frequente</span>
    <span class="syntax-number">3</span>: <span class="syntax-number">0.3</span>   <span class="syntax-comment"># Cluster dormente</span>
})

<span class="syntax-comment"># Combinar probabilidades</span>
final_prob = (prob_base + cluster_effect) / <span class="syntax-number">2</span>
final_prob = np.clip(final_prob, <span class="syntax-number">0</span>, <span class="syntax-number">1</span>)  <span class="syntax-comment"># Garantir entre 0 e 1</span>

<span class="syntax-comment"># Gerar target baseado na probabilidade</span>
np.random.seed(<span class="syntax-number">42</span>)
customer_segments[<span class="syntax-string">'will_purchase_next_month'</span>] = np.random.binomial(<span class="syntax-number">1</span>, final_prob)

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Target criado:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìà Comprar√° (1): {customer_segments['will_purchase_next_month'].sum():,} ({customer_segments['will_purchase_next_month'].mean()*100:.1f}%)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìâ N√£o comprar√° (0): {(customer_segments['will_purchase_next_month'] == 0).sum():,} ({(1-customer_segments['will_purchase_next_month'].mean())*100:.1f}%)"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 3: Feature Engineering -->
        <div class="section">
            <h2><span class="step-indicator">3</span>Feature Engineering: Criando Features Preditivas</h2>
            <p>Vamos criar features adicionais que podem melhorar nosso modelo de classifica√ß√£o.</p>

            <div class="code-block">
                <div class="code-header">
                    <span>üîß Engenharia de Features para Classifica√ß√£o</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># FEATURE ENGINEERING AVAN√áADO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üîß CRIANDO FEATURES ADICIONAIS"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 35</span>)

<span class="syntax-comment"># 1. Features derivadas do RFM</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üìä Criando features derivadas..."</span>)

<span class="syntax-comment"># RFM Score (combina√ß√£o das tr√™s dimens√µes)</span>
customer_segments[<span class="syntax-string">'RFM_Score'</span>] = (
    (<span class="syntax-number">1</span> / (<span class="syntax-number">1</span> + customer_segments[<span class="syntax-string">'Recency'</span>] / <span class="syntax-number">100</span>)) * <span class="syntax-number">0.33</span> +
    (customer_segments[<span class="syntax-string">'Frequency'</span>] / customer_segments[<span class="syntax-string">'Frequency'</span>].max()) * <span class="syntax-number">0.33</span> +
    (customer_segments[<span class="syntax-string">'Monetary'</span>] / customer_segments[<span class="syntax-string">'Monetary'</span>].max()) * <span class="syntax-number">0.33</span>
)

<span class="syntax-comment"># Valor m√©dio por transa√ß√£o</span>
customer_segments[<span class="syntax-string">'Avg_Order_Value'</span>] = customer_segments[<span class="syntax-string">'Monetary'</span>] / customer_segments[<span class="syntax-string">'Frequency'</span>]

<span class="syntax-comment"># Cliente recente (comprou nos √∫ltimos 30 dias)</span>
customer_segments[<span class="syntax-string">'Is_Recent_Customer'</span>] = (customer_segments[<span class="syntax-string">'Recency'</span>] <= <span class="syntax-number">30</span>).astype(<span class="syntax-keyword">int</span>)

<span class="syntax-comment"># Cliente frequente (acima da mediana de frequ√™ncia)</span>
freq_median = customer_segments[<span class="syntax-string">'Frequency'</span>].median()
customer_segments[<span class="syntax-string">'Is_Frequent_Customer'</span>] = (customer_segments[<span class="syntax-string">'Frequency'</span>] > freq_median).astype(<span class="syntax-keyword">int</span>)

<span class="syntax-comment"># Cliente alto valor (acima do percentil 75 de valor monet√°rio)</span>
monetary_p75 = customer_segments[<span class="syntax-string">'Monetary'</span>].quantile(<span class="syntax-number">0.75</span>)
customer_segments[<span class="syntax-string">'Is_High_Value'</span>] = (customer_segments[<span class="syntax-string">'Monetary'</span>] > monetary_p75).astype(<span class="syntax-keyword">int</span>)

<span class="syntax-comment"># 2. One-hot encoding dos clusters</span>
cluster_dummies = pd.get_dummies(customer_segments[<span class="syntax-string">'Cluster'</span>], prefix=<span class="syntax-string">'Cluster'</span>)
customer_segments = pd.concat([customer_segments, cluster_dummies], axis=<span class="syntax-number">1</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Features criadas:"</span>)
new_features = [<span class="syntax-string">'RFM_Score'</span>, <span class="syntax-string">'Avg_Order_Value'</span>, <span class="syntax-string">'Is_Recent_Customer'</span>, 
                <span class="syntax-string">'Is_Frequent_Customer'</span>, <span class="syntax-string">'Is_High_Value'</span>] + list(cluster_dummies.columns)
<span class="syntax-keyword">for</span> feature <span class="syntax-keyword">in</span> new_features:
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚Ä¢ {feature}"</span>)

<span class="syntax-comment"># 3. AN√ÅLISE EXPLORAT√ìRIA DA TARGET</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìä AN√ÅLISE DA VARI√ÅVEL TARGET"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 32</span>)

<span class="syntax-comment"># Correla√ß√£o das features com a target</span>
numeric_features = [<span class="syntax-string">'Recency'</span>, <span class="syntax-string">'Frequency'</span>, <span class="syntax-string">'Monetary'</span>, <span class="syntax-string">'RFM_Score'</span>, 
                   <span class="syntax-string">'Avg_Order_Value'</span>, <span class="syntax-string">'Is_Recent_Customer'</span>, <span class="syntax-string">'Is_Frequent_Customer'</span>, 
                   <span class="syntax-string">'Is_High_Value'</span>] + list(cluster_dummies.columns)

correlations = customer_segments[numeric_features + [<span class="syntax-string">'will_purchase_next_month'</span>]].corr()[<span class="syntax-string">'will_purchase_next_month'</span>].drop(<span class="syntax-string">'will_purchase_next_month'</span>)
correlations_sorted = correlations.abs().sort_values(ascending=<span class="syntax-keyword">False</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"üîó Correla√ß√µes com target (ordenadas por magnitude):"</span>)
<span class="syntax-keyword">for</span> feature, corr <span class="syntax-keyword">in</span> correlations_sorted.head(<span class="syntax-number">8</span>).items():
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   {feature:20s}: {corr:+.3f}"</span>)

<span class="syntax-comment"># An√°lise por cluster</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüè∑Ô∏è Taxa de convers√£o por cluster:"</span>)
conversion_by_cluster = customer_segments.groupby(<span class="syntax-string">'Cluster'</span>)[<span class="syntax-string">'will_purchase_next_month'</span>].mean()
<span class="syntax-keyword">for</span> cluster, rate <span class="syntax-keyword">in</span> conversion_by_cluster.items():
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   Cluster {cluster}: {rate:.1%}"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 4: Implementa√ß√£o da Regress√£o Log√≠stica -->
        <div class="section">
            <h2><span class="step-indicator">4</span>Modelo: Implementando Regress√£o Log√≠stica</h2>
            
            <div class="concept-box">
                <h4>üéØ Processo de Modelagem</h4>
                <p><strong>1. Divis√£o dos dados:</strong> Treino (70%) e Teste (30%)<br>
                <strong>2. Normaliza√ß√£o:</strong> StandardScaler para features num√©ricas<br>
                <strong>3. Treinamento:</strong> Ajustar modelo aos dados de treino<br>
                <strong>4. Avalia√ß√£o:</strong> M√©tricas no conjunto de teste<br>
                <strong>5. Interpreta√ß√£o:</strong> Coeficientes e import√¢ncia das features</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>ü§ñ Implementa√ß√£o do Modelo de Regress√£o Log√≠stica</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># PREPARA√á√ÉO PARA MODELAGEM</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"ü§ñ IMPLEMENTA√á√ÉO REGRESS√ÉO LOG√çSTICA"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 40</span>)

<span class="syntax-comment"># 1. Definir features e target</span>
feature_columns = [<span class="syntax-string">'Recency'</span>, <span class="syntax-string">'Frequency'</span>, <span class="syntax-string">'Monetary'</span>, <span class="syntax-string">'RFM_Score'</span>, 
                  <span class="syntax-string">'Avg_Order_Value'</span>, <span class="syntax-string">'Is_Recent_Customer'</span>, <span class="syntax-string">'Is_Frequent_Customer'</span>, 
                  <span class="syntax-string">'Is_High_Value'</span>] + [col <span class="syntax-keyword">for</span> col <span class="syntax-keyword">in</span> customer_segments.columns <span class="syntax-keyword">if</span> col.startswith(<span class="syntax-string">'Cluster_'</span>)]

X = customer_segments[feature_columns]
y = customer_segments[<span class="syntax-string">'will_purchase_next_month'</span>]

<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä Features selecionadas: {len(feature_columns)}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üìà Samples: {len(X):,}"</span>)

<span class="syntax-comment"># 2. Divis√£o treino/teste</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüîÄ Dividindo dados em treino/teste..."</span>)
X_train, X_test, y_train, y_test = train_test_split(
    X, y, test_size=<span class="syntax-number">0.3</span>, random_state=<span class="syntax-number">42</span>, stratify=y
)

<span class="syntax-function">print</span>(<span class="syntax-string">f"   üèãÔ∏è Treino: {len(X_train):,} samples"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üß™ Teste: {len(X_test):,} samples"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìä Propor√ß√£o positive class - Treino: {y_train.mean():.3f}, Teste: {y_test.mean():.3f}"</span>)

<span class="syntax-comment"># 3. Normaliza√ß√£o das features</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüîß Normalizando features..."</span>)
scaler = StandardScaler()
X_train_scaled = scaler.fit_transform(X_train)
X_test_scaled = scaler.transform(X_test)

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Normaliza√ß√£o conclu√≠da"</span>)

<span class="syntax-comment"># 4. TREINAMENTO DO MODELO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüöÄ Treinando modelo de Regress√£o Log√≠stica..."</span>)

<span class="syntax-comment"># Testando diferentes valores de regulariza√ß√£o</span>
C_values = [<span class="syntax-number">0.1</span>, <span class="syntax-number">1</span>, <span class="syntax-number">10</span>, <span class="syntax-number">100</span>]
best_score = <span class="syntax-number">0</span>
best_C = <span class="syntax-number">1</span>

<span class="syntax-keyword">for</span> C <span class="syntax-keyword">in</span> C_values:
    lr = LogisticRegression(C=C, random_state=<span class="syntax-number">42</span>, max_iter=<span class="syntax-number">1000</span>)
    scores = cross_val_score(lr, X_train_scaled, y_train, cv=<span class="syntax-number">5</span>, scoring=<span class="syntax-string">'roc_auc'</span>)
    avg_score = scores.mean()
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   C={C}: AUC = {avg_score:.4f} ¬± {scores.std():.4f}"</span>)
    
    <span class="syntax-keyword">if</span> avg_score > best_score:
        best_score = avg_score
        best_C = C

<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ Melhor C: {best_C} (AUC: {best_score:.4f})"</span>)

<span class="syntax-comment"># Treinar modelo final</span>
lr_final = LogisticRegression(C=best_C, random_state=<span class="syntax-number">42</span>, max_iter=<span class="syntax-number">1000</span>)
lr_final.fit(X_train_scaled, y_train)

<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Modelo treinado!"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 5: Avalia√ß√£o do Modelo -->
        <div class="section">
            <h2><span class="step-indicator">5</span>Avalia√ß√£o: M√©tricas e Performance</h2>
            
            <div class="metrics-box">
                <h4>üìä M√©tricas de Classifica√ß√£o</h4>
                <p><strong>Accuracy:</strong> % de previs√µes corretas (pode ser enganosa com classes desbalanceadas)<br>
                <strong>Precision:</strong> De todos que prevemos como positivo, quantos realmente s√£o?<br>
                <strong>Recall (Sensitivity):</strong> De todos os positivos reais, quantos conseguimos identificar?<br>
                <strong>F1-Score:</strong> M√©dia harm√¥nica entre precision e recall<br>
                <strong>AUC-ROC:</strong> √Årea sob curva ROC - capacidade de distin√ß√£o entre classes</p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üìà Avalia√ß√£o Completa do Modelo</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># AVALIA√á√ÉO DO MODELO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üìä AVALIA√á√ÉO DO MODELO"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 25</span>)

<span class="syntax-comment"># 1. Fazer previs√µes</span>
y_pred = lr_final.predict(X_test_scaled)
y_pred_proba = lr_final.predict_proba(X_test_scaled)[:, <span class="syntax-number">1</span>]  <span class="syntax-comment"># Probabilidade da classe positiva</span>

<span class="syntax-comment"># 2. M√âTRICAS PRINCIPAIS</span>
accuracy = accuracy_score(y_test, y_pred)
precision = precision_score(y_test, y_pred)
recall = recall_score(y_test, y_pred)
f1 = f1_score(y_test, y_pred)
auc = roc_auc_score(y_test, y_pred_proba)

<span class="syntax-function">print</span>(<span class="syntax-string">f"üéØ M√âTRICAS DE PERFORMANCE:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìä Accuracy:  {accuracy:.4f} ({accuracy*100:.2f}%)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üéØ Precision: {precision:.4f} ({precision*100:.2f}%)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üì° Recall:    {recall:.4f} ({recall*100:.2f}%)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚öñÔ∏è F1-Score:  {f1:.4f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìà AUC-ROC:   {auc:.4f}"</span>)

<span class="syntax-comment"># 3. Matriz de Confus√£o</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüîç MATRIZ DE CONFUS√ÉO:"</span>)
cm = confusion_matrix(y_test, y_pred)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   {cm}"</span>)

tn, fp, fn, tp = cm.ravel()
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìã Interpreta√ß√£o:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚úÖ True Negatives (Correto - N√£o comprar√°):  {tn:,}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚ùå False Positives (Erro - Previu compra):    {fp:,}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚ùå False Negatives (Erro - Perdeu compra):   {fn:,}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚úÖ True Positives (Correto - Comprar√°):      {tp:,}"</span>)

<span class="syntax-comment"># 4. Relat√≥rio de classifica√ß√£o detalhado</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüìã RELAT√ìRIO DETALHADO:"</span>)
<span class="syntax-function">print</span>(classification_report(y_test, y_pred, 
                              target_names=[<span class="syntax-string">'N√£o Comprar√°'</span>, <span class="syntax-string">'Comprar√°'</span>]))

<span class="syntax-comment"># 5. AN√ÅLISE DE IMPORT√ÇNCIA DAS FEATURES</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"üîç IMPORT√ÇNCIA DAS FEATURES (Coeficientes):"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 45</span>)

feature_importance = pd.DataFrame({
    <span class="syntax-string">'Feature'</span>: feature_columns,
    <span class="syntax-string">'Coefficient'</span>: lr_final.coef_[<span class="syntax-number">0</span>],
    <span class="syntax-string">'Abs_Coefficient'</span>: np.abs(lr_final.coef_[<span class="syntax-number">0</span>])
}).sort_values(<span class="syntax-string">'Abs_Coefficient'</span>, ascending=<span class="syntax-keyword">False</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä Top 10 features mais importantes:"</span>)
<span class="syntax-keyword">for</span> idx, row <span class="syntax-keyword">in</span> feature_importance.head(<span class="syntax-number">10</span>).iterrows():
    impact = <span class="syntax-string">"‚ÜóÔ∏è Positivo"</span> <span class="syntax-keyword">if</span> row[<span class="syntax-string">'Coefficient'</span>] > <span class="syntax-number">0</span> <span class="syntax-keyword">else</span> <span class="syntax-string">"‚ÜòÔ∏è Negativo"</span>
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   {row['Feature']:20s}: {row['Coefficient']:+.4f} {impact}"</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüí° Interpreta√ß√£o dos coeficientes:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚Ä¢ Coeficiente positivo: aumenta probabilidade de compra"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚Ä¢ Coeficiente negativo: diminui probabilidade de compra"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚Ä¢ Valor absoluto: magnitude do impacto"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 6: Visualiza√ß√µes e Insights -->
        <div class="section">
            <h2><span class="step-indicator">6</span>Visualiza√ß√£o: Insights do Modelo</h2>
            
            <div class="code-block">
                <div class="code-header">
                    <span>üìä Criando Visualiza√ß√µes dos Resultados</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># VISUALIZA√á√ïES DOS RESULTADOS</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üìä CRIANDO VISUALIZA√á√ïES"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 28</span>)

fig = plt.figure(figsize=(<span class="syntax-number">16</span>, <span class="syntax-number">12</span>))

<span class="syntax-comment"># 1. Curva ROC</span>
ax1 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">3</span>, <span class="syntax-number">1</span>)
fpr, tpr, thresholds = roc_curve(y_test, y_pred_proba)
ax1.plot(fpr, tpr, color=<span class="syntax-string">'blue'</span>, linewidth=<span class="syntax-number">2</span>, label=<span class="syntax-string">f'ROC Curve (AUC = {auc:.3f})'</span>)
ax1.plot([<span class="syntax-number">0</span>, <span class="syntax-number">1</span>], [<span class="syntax-number">0</span>, <span class="syntax-number">1</span>], color=<span class="syntax-string">'red'</span>, linestyle=<span class="syntax-string">'--'</span>, label=<span class="syntax-string">'Random Classifier'</span>)
ax1.set_xlabel(<span class="syntax-string">'False Positive Rate'</span>)
ax1.set_ylabel(<span class="syntax-string">'True Positive Rate'</span>)
ax1.set_title(<span class="syntax-string">'Curva ROC'</span>)
ax1.legend()
ax1.grid(<span class="syntax-keyword">True</span>)

<span class="syntax-comment"># 2. Distribui√ß√£o das probabilidades preditas</span>
ax2 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">3</span>, <span class="syntax-number">2</span>)
ax2.hist(y_pred_proba[y_test == <span class="syntax-number">0</span>], bins=<span class="syntax-number">30</span>, alpha=<span class="syntax-number">0.7</span>, label=<span class="syntax-string">'N√£o Comprar√°'</span>, color=<span class="syntax-string">'red'</span>)
ax2.hist(y_pred_proba[y_test == <span class="syntax-number">1</span>], bins=<span class="syntax-number">30</span>, alpha=<span class="syntax-number">0.7</span>, label=<span class="syntax-string">'Comprar√°'</span>, color=<span class="syntax-string">'blue'</span>)
ax2.axvline(x=<span class="syntax-number">0.5</span>, color=<span class="syntax-string">'black'</span>, linestyle=<span class="syntax-string">'--'</span>, label=<span class="syntax-string">'Threshold'</span>)
ax2.set_xlabel(<span class="syntax-string">'Probabilidade Predita'</span>)
ax2.set_ylabel(<span class="syntax-string">'Frequ√™ncia'</span>)
ax2.set_title(<span class="syntax-string">'Distribui√ß√£o das Probabilidades'</span>)
ax2.legend()

<span class="syntax-comment"># 3. Matriz de Confus√£o (Heatmap)</span>
ax3 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">3</span>, <span class="syntax-number">3</span>)
sns.heatmap(cm, annot=<span class="syntax-keyword">True</span>, fmt=<span class="syntax-string">'d'</span>, cmap=<span class="syntax-string">'Blues'</span>, ax=ax3,
            xticklabels=[<span class="syntax-string">'N√£o Comprar√°'</span>, <span class="syntax-string">'Comprar√°'</span>],
            yticklabels=[<span class="syntax-string">'N√£o Comprar√°'</span>, <span class="syntax-string">'Comprar√°'</span>])
ax3.set_title(<span class="syntax-string">'Matriz de Confus√£o'</span>)
ax3.set_ylabel(<span class="syntax-string">'Valor Real'</span>)
ax3.set_xlabel(<span class="syntax-string">'Previs√£o'</span>)

<span class="syntax-comment"># 4. Import√¢ncia das Features</span>
ax4 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">3</span>, <span class="syntax-number">4</span>)
top_features = feature_importance.head(<span class="syntax-number">8</span>)
colors = [<span class="syntax-string">'green'</span> <span class="syntax-keyword">if</span> x > <span class="syntax-number">0</span> <span class="syntax-keyword">else</span> <span class="syntax-string">'red'</span> <span class="syntax-keyword">for</span> x <span class="syntax-keyword">in</span> top_features[<span class="syntax-string">'Coefficient'</span>]]
ax4.barh(<span class="syntax-function">range</span>(<span class="syntax-function">len</span>(top_features)), top_features[<span class="syntax-string">'Coefficient'</span>], color=colors)
ax4.set_yticks(<span class="syntax-function">range</span>(<span class="syntax-function">len</span>(top_features)))
ax4.set_yticklabels(top_features[<span class="syntax-string">'Feature'</span>])
ax4.set_xlabel(<span class="syntax-string">'Coeficiente'</span>)
ax4.set_title(<span class="syntax-string">'Top 8 Features Mais Importantes'</span>)
ax4.axvline(x=<span class="syntax-number">0</span>, color=<span class="syntax-string">'black'</span>, linestyle=<span class="syntax-string">'-'</span>, alpha=<span class="syntax-number">0.3</span>)

<span class="syntax-comment"># 5. Performance por Cluster</span>
ax5 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">3</span>, <span class="syntax-number">5</span>)
<span class="syntax-comment"># Criar DataFrame para an√°lise por cluster</span>
test_results = pd.DataFrame({
    <span class="syntax-string">'Cluster'</span>: X_test[<span class="syntax-string">'Cluster_0'</span>] * <span class="syntax-number">0</span> + X_test[<span class="syntax-string">'Cluster_1'</span>] * <span class="syntax-number">1</span> + 
              X_test[<span class="syntax-string">'Cluster_2'</span>] * <span class="syntax-number">2</span> + X_test[<span class="syntax-string">'Cluster_3'</span>] * <span class="syntax-number">3</span>,
    <span class="syntax-string">'Real'</span>: y_test,
    <span class="syntax-string">'Predicted'</span>: y_pred_proba
})

cluster_performance = test_results.groupby(<span class="syntax-string">'Cluster'</span>).agg({
    <span class="syntax-string">'Real'</span>: <span class="syntax-string">'mean'</span>,
    <span class="syntax-string">'Predicted'</span>: <span class="syntax-string">'mean'</span>
}).reset_index()

x = np.arange(<span class="syntax-function">len</span>(cluster_performance))
width = <span class="syntax-number">0.35</span>
ax5.bar(x - width/<span class="syntax-number">2</span>, cluster_performance[<span class="syntax-string">'Real'</span>], width, label=<span class="syntax-string">'Taxa Real'</span>, alpha=<span class="syntax-number">0.8</span>)
ax5.bar(x + width/<span class="syntax-number">2</span>, cluster_performance[<span class="syntax-string">'Predicted'</span>], width, label=<span class="syntax-string">'Prob. Predita'</span>, alpha=<span class="syntax-number">0.8</span>)
ax5.set_xlabel(<span class="syntax-string">'Cluster'</span>)
ax5.set_ylabel(<span class="syntax-string">'Taxa/Probabilidade'</span>)
ax5.set_title(<span class="syntax-string">'Performance por Cluster'</span>)
ax5.set_xticks(x)
ax5.set_xticklabels([<span class="syntax-string">f'Cluster {i}'</span> <span class="syntax-keyword">for</span> i <span class="syntax-keyword">in</span> cluster_performance[<span class="syntax-string">'Cluster'</span>]])
ax5.legend()

<span class="syntax-comment"># 6. Calibra√ß√£o do modelo</span>
ax6 = fig.add_subplot(<span class="syntax-number">2</span>, <span class="syntax-number">3</span>, <span class="syntax-number">6</span>)
<span class="syntax-comment"># Criar bins de probabilidade</span>
n_bins = <span class="syntax-number">10</span>
bin_boundaries = np.linspace(<span class="syntax-number">0</span>, <span class="syntax-number">1</span>, n_bins + <span class="syntax-number">1</span>)
bin_lowers = bin_boundaries[:-<span class="syntax-number">1</span>]
bin_uppers = bin_boundaries[<span class="syntax-number">1</span>:]

true_probs = []
pred_probs = []
<span class="syntax-keyword">for</span> bin_lower, bin_upper <span class="syntax-keyword">in</span> <span class="syntax-function">zip</span>(bin_lowers, bin_uppers):
    in_bin = (y_pred_proba > bin_lower) & (y_pred_proba <= bin_upper)
    <span class="syntax-keyword">if</span> in_bin.<span class="syntax-function">sum</span>() > <span class="syntax-number">0</span>:
        true_probs.append(y_test[in_bin].mean())
        pred_probs.append(y_pred_proba[in_bin].mean())

ax6.plot([<span class="syntax-number">0</span>, <span class="syntax-number">1</span>], [<span class="syntax-number">0</span>, <span class="syntax-number">1</span>], <span class="syntax-string">'k:'</span>, label=<span class="syntax-string">'Perfeitamente calibrado'</span>)
ax6.plot(pred_probs, true_probs, <span class="syntax-string">'s-'</span>, label=<span class="syntax-string">'Modelo'</span>)
ax6.set_xlabel(<span class="syntax-string">'Probabilidade Predita'</span>)
ax6.set_ylabel(<span class="syntax-string">'Fra√ß√£o Positiva'</span>)
ax6.set_title(<span class="syntax-string">'Calibra√ß√£o do Modelo'</span>)
ax6.legend()

plt.tight_layout()
plt.show()

<span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Visualiza√ß√µes criadas!"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 7: Insights de Neg√≥cio -->
        <div class="section">
            <h2><span class="step-indicator">7</span>Insights de Neg√≥cio: A√ß√µes Pr√°ticas</h2>
            
            <div class="code-block">
                <div class="code-header">
                    <span>üíº Traduzindo Modelo em Estrat√©gias de Neg√≥cio</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># INSIGHTS DE NEG√ìCIO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üí° INSIGHTS DE NEG√ìCIO"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 25</span>)

<span class="syntax-comment"># 1. SEGMENTA√á√ÉO POR PROBABILIDADE</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üéØ SEGMENTA√á√ÉO POR PROBABILIDADE DE COMPRA:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 45</span>)

<span class="syntax-comment"># Criar segmentos baseados na probabilidade predita</span>
test_data = pd.DataFrame({
    <span class="syntax-string">'CustomerID'</span>: X_test.index,
    <span class="syntax-string">'Probability'</span>: y_pred_proba,
    <span class="syntax-string">'Prediction'</span>: y_pred,
    <span class="syntax-string">'Real'</span>: y_test
})

<span class="syntax-comment"># Definir segmentos</span>
<span class="syntax-keyword">def</span> <span class="syntax-function">classify_probability</span>(prob):
    <span class="syntax-keyword">if</span> prob >= <span class="syntax-number">0.8</span>:
        <span class="syntax-keyword">return</span> <span class="syntax-string">"üî• Muito Prov√°vel (80%+)"</span>
    <span class="syntax-keyword">elif</span> prob >= <span class="syntax-number">0.6</span>:
        <span class="syntax-keyword">return</span> <span class="syntax-string">"üìà Prov√°vel (60-80%)"</span>
    <span class="syntax-keyword">elif</span> prob >= <span class="syntax-number">0.4</span>:
        <span class="syntax-keyword">return</span> <span class="syntax-string">"‚öñÔ∏è Incerto (40-60%)"</span>
    <span class="syntax-keyword">elif</span> prob >= <span class="syntax-number">0.2</span>:
        <span class="syntax-keyword">return</span> <span class="syntax-string">"üìâ Pouco Prov√°vel (20-40%)"</span>
    <span class="syntax-keyword">else</span>:
        <span class="syntax-keyword">return</span> <span class="syntax-string">"‚ùÑÔ∏è Muito Improv√°vel (<20%)"</span>

test_data[<span class="syntax-string">'Segment'</span>] = test_data[<span class="syntax-string">'Probability'</span>].apply(classify_probability)

<span class="syntax-comment"># Analisar cada segmento</span>
segment_analysis = test_data.groupby(<span class="syntax-string">'Segment'</span>).agg({
    <span class="syntax-string">'Probability'</span>: [<span class="syntax-string">'mean'</span>, <span class="syntax-string">'count'</span>],
    <span class="syntax-string">'Real'</span>: <span class="syntax-string">'mean'</span>
}).round(<span class="syntax-number">3</span>)

segment_analysis.columns = [<span class="syntax-string">'Prob_M√©dia'</span>, <span class="syntax-string">'Qtd_Clientes'</span>, <span class="syntax-string">'Taxa_Real'</span>]

<span class="syntax-keyword">for</span> segment, data <span class="syntax-keyword">in</span> segment_analysis.iterrows():
    <span class="syntax-function">print</span>(<span class="syntax-string">f"\n{segment}:"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üë• Clientes: {data['Qtd_Clientes']:,} ({data['Qtd_Clientes']/len(test_data)*100:.1f}%)"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   üéØ Probabilidade m√©dia: {data['Prob_M√©dia']:.1%}"</span>)
    <span class="syntax-function">print</span>(<span class="syntax-string">f"   ‚úÖ Taxa real de convers√£o: {data['Taxa_Real']:.1%}"</span>)
    
    <span class="syntax-comment"># Recomenda√ß√µes espec√≠ficas</span>
    <span class="syntax-keyword">if</span> <span class="syntax-string">"Muito Prov√°vel"</span> <span class="syntax-keyword">in</span> segment:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üíº A√á√ÉO: Oferecer produtos premium, desconto VIP"</span>)
    <span class="syntax-keyword">elif</span> <span class="syntax-string">"Prov√°vel"</span> <span class="syntax-keyword">in</span> segment:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üíº A√á√ÉO: Email marketing personalizado"</span>)
    <span class="syntax-keyword">elif</span> <span class="syntax-string">"Incerto"</span> <span class="syntax-keyword">in</span> segment:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üíº A√á√ÉO: Teste A/B com diferentes ofertas"</span>)
    <span class="syntax-keyword">elif</span> <span class="syntax-string">"Pouco"</span> <span class="syntax-keyword">in</span> segment:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üíº A√á√ÉO: Campanha de reengajamento"</span>)
    <span class="syntax-keyword">else</span>:
        <span class="syntax-function">print</span>(<span class="syntax-string">f"   üíº A√á√ÉO: Foco em reten√ß√£o b√°sica, baixo investimento"</span>)

<span class="syntax-comment"># 2. AN√ÅLISE FINANCEIRA</span>
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüí∞ AN√ÅLISE DE IMPACTO FINANCEIRO:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 35</span>)

<span class="syntax-comment"># Assumir valores m√©dios para c√°lculo</span>
avg_order_value = <span class="syntax-number">150</span>  <span class="syntax-comment"># R$ valor m√©dio do pedido</span>
campaign_cost_per_customer = <span class="syntax-number">10</span>  <span class="syntax-comment"># R$ custo por cliente na campanha</span>
total_test_customers = <span class="syntax-function">len</span>(test_data)

<span class="syntax-comment"># Estrat√©gia 1: Campanha para todos</span>
strategy1_cost = total_test_customers * campaign_cost_per_customer
strategy1_revenue = test_data[<span class="syntax-string">'Real'</span>].<span class="syntax-function">sum</span>() * avg_order_value
strategy1_profit = strategy1_revenue - strategy1_cost

<span class="syntax-comment"># Estrat√©gia 2: Campanha apenas para probabilidade > 50%</span>
high_prob_customers = (test_data[<span class="syntax-string">'Probability'</span>] > <span class="syntax-number">0.5</span>).<span class="syntax-function">sum</span>()
strategy2_cost = high_prob_customers * campaign_cost_per_customer
strategy2_revenue = test_data[test_data[<span class="syntax-string">'Probability'</span>] > <span class="syntax-number">0.5</span>][<span class="syntax-string">'Real'</span>].<span class="syntax-function">sum</span>() * avg_order_value
strategy2_profit = strategy2_revenue - strategy2_cost

<span class="syntax-function">print</span>(<span class="syntax-string">f"üìä COMPARA√á√ÉO DE ESTRAT√âGIAS:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ Estrat√©gia 1 - Campanha para Todos:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üë• Clientes alvo: {total_test_customers:,}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∏ Custo: R$ {strategy1_cost:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∞ Receita: R$ {strategy1_revenue:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìà Lucro: R$ {strategy1_profit:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìä ROI: {(strategy1_profit/strategy1_cost*100):.1f}%"</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéØ Estrat√©gia 2 - Apenas Alta Probabilidade (>50%):"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üë• Clientes alvo: {high_prob_customers:,}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∏ Custo: R$ {strategy2_cost:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üí∞ Receita: R$ {strategy2_revenue:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìà Lucro: R$ {strategy2_profit:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"   üìä ROI: {(strategy2_profit/strategy2_cost*100):.1f}%"</span>)

savings = strategy1_cost - strategy2_cost
<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüí° ECONOMIA com segmenta√ß√£o: R$ {savings:,.2f}"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Estrat√©gia recomendada: {'2 - Segmentada' if strategy2_profit > strategy1_profit else '1 - Ampla'}"</span>)</code></pre>
            </div>
        </div>

        <!-- Parte 8: Checkpoint 2 -->
        <div class="section">
            <h2><span class="step-indicator">8</span>Finaliza√ß√£o: Checkpoint 2 Completo</h2>
            
            <div class="checkpoint-box">
                <h3>üéØ Checkpoint 2 (02/09) - CHECKLIST FINAL</h3>
                <p><strong>‚úÖ EDA completa com estat√≠sticas descritivas</strong><br>
                <strong>‚úÖ K-Means implementado e interpretado</strong><br>
                <strong>‚úÖ Regress√£o Log√≠stica implementada</strong><br>
                <strong>‚úÖ Avalia√ß√£o com m√©tricas adequadas</strong><br>
                <strong>‚úÖ Visualiza√ß√µes impactantes</strong><br>
                <strong>‚úÖ Insights de neg√≥cio documentados</strong><br>
                <strong>‚úÖ An√°lise financeira e ROI</strong></p>
            </div>

            <div class="code-block">
                <div class="code-header">
                    <span>üíæ Salvando Projeto Completo</span>
                    <button class="copy-btn" onclick="copyCode(this)">Copiar</button>
                </div>
<pre><code><span class="syntax-comment"># SALVANDO PROJETO COMPLETO</span>
<span class="syntax-function">print</span>(<span class="syntax-string">"üíæ SALVANDO PROJETO CHECKPOINT 2"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"=" * 35</span>)

<span class="syntax-comment"># 1. Salvar modelo de regress√£o log√≠stica</span>
<span class="syntax-keyword">with</span> <span class="syntax-function">open</span>(<span class="syntax-string">'logistic_regression_model.pkl'</span>, <span class="syntax-string">'wb'</span>) <span class="syntax-keyword">as</span> f:
    pickle.dump(lr_final, f)

<span class="syntax-comment"># 2. Salvar scaler</span>
<span class="syntax-keyword">with</span> <span class="syntax-function">open</span>(<span class="syntax-string">'logistic_scaler.pkl'</span>, <span class="syntax-string">'wb'</span>) <span class="syntax-keyword">as</span> f:
    pickle.dump(scaler, f)

<span class="syntax-comment"># 3. Salvar dados com previs√µes</span>
test_data.to_csv(<span class="syntax-string">'customer_predictions.csv'</span>)

<span class="syntax-comment"># 4. Salvar features importantes</span>
feature_importance.to_csv(<span class="syntax-string">'feature_importance.csv'</span>, index=<span class="syntax-keyword">False</span>)

<span class="syntax-comment"># 5. Criar relat√≥rio resumido</span>
report = <span class="syntax-string">f"""
RELAT√ìRIO CHECKPOINT 2 - SISTEMAS INTELIGENTES
============================================

1. DATASET:
   - {len(customer_segments):,} clientes analisados
   - Features: RFM + Clusters + Derivadas
   - Target: Probabilidade de compra (pr√≥ximos 30 dias)

2. MODELOS IMPLEMENTADOS:
   ‚úÖ K-Means Clustering (4 clusters)
   ‚úÖ Regress√£o Log√≠stica para classifica√ß√£o

3. PERFORMANCE DO MODELO:
   - Accuracy: {accuracy:.3f}
   - Precision: {precision:.3f}
   - Recall: {recall:.3f}
   - F1-Score: {f1:.3f}
   - AUC-ROC: {auc:.3f}

4. PRINCIPAIS INSIGHTS:
   - Feature mais importante: {feature_importance.iloc[0]['Feature']}
   - ROI da campanha segmentada: {(strategy2_profit/strategy2_cost*100):.1f}%
   - Economia potencial: R$ {savings:,.2f}

5. RECOMENDA√á√ïES DE NEG√ìCIO:
   - Focar campanha em clientes com prob > 50%
   - Implementar estrat√©gias diferenciadas por segmento
   - Monitorar performance continuamente

Data: {datetime.now().strftime('%d/%m/%Y %H:%M')}
"""</span>

<span class="syntax-keyword">with</span> <span class="syntax-function">open</span>(<span class="syntax-string">'relatorio_checkpoint2.txt'</span>, <span class="syntax-string">'w'</span>, encoding=<span class="syntax-string">'utf-8'</span>) <span class="syntax-keyword">as</span> f:
    f.write(report)

<span class="syntax-function">print</span>(<span class="syntax-string">"‚úÖ Arquivos salvos:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   ü§ñ logistic_regression_model.pkl - Modelo treinado"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   üîß logistic_scaler.pkl - Scaler para features"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   üìä customer_predictions.csv - Previs√µes dos clientes"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   üìã feature_importance.csv - Import√¢ncia das features"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">"   üìÑ relatorio_checkpoint2.txt - Relat√≥rio completo"</span>)

<span class="syntax-function">print</span>(<span class="syntax-string">f"\nüéâ CHECKPOINT 2 COMPLETO!"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"Implementaram com sucesso:"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ An√°lise Explorat√≥ria de Dados"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Algoritmo de Clustering (K-Means)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Algoritmo de Classifica√ß√£o (Regress√£o Log√≠stica)"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Avalia√ß√£o e M√©tricas de Performance"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"‚úÖ Insights Acion√°veis de Neg√≥cio"</span>)
<span class="syntax-function">print</span>(<span class="syntax-string">f"üöÄ Pr√≥ximo: Aplica√ß√µes de IA para Gest√£o Empresarial!"</span>)</code></pre>
            </div>

            <div class="grid">
                <div class="card">
                    <h3>üìã Para a Apresenta√ß√£o (02/09)</h3>
                    <p><strong>10 minutos m√°ximo:</strong><br>
                    ‚Ä¢ 2 min: Problema e dataset<br>
                    ‚Ä¢ 3 min: K-Means + clusters<br>
                    ‚Ä¢ 3 min: Regress√£o Log√≠stica + m√©tricas<br>
                    ‚Ä¢ 2 min: Insights e ROI</p>
                </div>
                <div class="card">
                    <h3>üöÄ Pr√≥xima Aula (02/09)</h3>
                    <p><strong>Unidade III:</strong> Aplica√ß√µes de IA para gest√£o empresarial<br>
                    <strong>Ferramentas:</strong> ChatGPT, Gemini, Copilot<br>
                    <strong>Foco:</strong> Casos pr√°ticos na Engenharia</p>
                </div>
            </div>
        </div>

        <div class="highlight-box">
            <h3>üåü Parab√©ns pelo Checkpoint 2!</h3>
            <p>Voc√™s completaram um <strong>pipeline completo de Machine Learning</strong>! Desde a an√°lise explorat√≥ria at√© insights de neg√≥cio, passando por clustering e classifica√ß√£o. Isso √© exatamente o que fazem cientistas de dados profissionais. Na pr√≥xima unidade, vamos aplicar ferramentas de IA j√° prontas para resolver problemas reais da engenharia!</p>
        </div>
    </div>

    <script>
        function copyCode(button) {
            const codeBlock = button.closest('.code-block');
            const code = codeBlock.querySelector('code').textContent;
            
            navigator.clipboard.writeText(code).then(function() {
                button.textContent = 'Copiado!';
                button.style.background = '#28a745';
                
                setTimeout(function() {
                    button.textContent = 'Copiar';
                    button.style.background = '#667eea';
                }, 2000);
            });
        }
    </script>
</body>
</html>